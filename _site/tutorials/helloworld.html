<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>Helloworld - M3O Dev</title> <link rel="shortcut icon" href="http://0.0.0.0:4000/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="http://0.0.0.0:4000/assets/css/just-the-docs-default.css"> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-70478210-5"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-70478210-5'); </script> <script type="text/javascript" src="http://0.0.0.0:4000/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="http://0.0.0.0:4000/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.6.1 --> <title>Helloworld | M3O Dev</title> <meta name="generator" content="Jekyll v4.0.1" /> <meta property="og:title" content="Helloworld" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="M3O dev site - getting started, docs, tutorials and more." /> <meta property="og:description" content="M3O dev site - getting started, docs, tutorials and more." /> <link rel="canonical" href="http://0.0.0.0:4000/tutorials/helloworld" /> <meta property="og:url" content="http://0.0.0.0:4000/tutorials/helloworld" /> <meta property="og:site_name" content="M3O Dev" /> <script type="application/ld+json"> {"url":"http://0.0.0.0:4000/tutorials/helloworld","description":"M3O dev site - getting started, docs, tutorials and more.","@type":"WebPage","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://0.0.0.0:4000/assets/images/logo.png"}},"headline":"Helloworld","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="http://0.0.0.0:4000/" class="site-title lh-tight"> <div class="site-logo"></div> </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="http://0.0.0.0:4000/" class="nav-list-link">Home</a></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://0.0.0.0:4000/getting-started" class="nav-list-link">Get Started</a><ul class="nav-list "><li class="nav-list-item "><a href="http://0.0.0.0:4000/getting-started/create-services" class="nav-list-link">Create Services</a></li><li class="nav-list-item "><a href="http://0.0.0.0:4000/getting-started/invite-users" class="nav-list-link">Invite Users</a></li><li class="nav-list-item "><a href="http://0.0.0.0:4000/getting-started/private-repos" class="nav-list-link">Private Repos</a></li><li class="nav-list-item "><a href="http://0.0.0.0:4000/getting-started/public-apis" class="nav-list-link">Public APIs</a></li><li class="nav-list-item "><a href="http://0.0.0.0:4000/getting-started/using-micro" class="nav-list-link">Using Micro</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://0.0.0.0:4000/concepts" class="nav-list-link">Concepts</a><ul class="nav-list "><li class="nav-list-item "><a href="http://0.0.0.0:4000/concepts/framework" class="nav-list-link">Framework</a></li><li class="nav-list-item "><a href="http://0.0.0.0:4000/concepts/platform" class="nav-list-link">Platform</a></li></ul></li><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://0.0.0.0:4000/tutorials" class="nav-list-link">Tutorials</a><ul class="nav-list "><li class="nav-list-item active"><a href="http://0.0.0.0:4000/tutorials/helloworld" class="nav-list-link active">Helloworld</a></li><li class="nav-list-item "><a href="http://0.0.0.0:4000/tutorials/authentication" class="nav-list-link">Authentication</a></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://0.0.0.0:4000/tutorials/building-a-blog" class="nav-list-link">Building A Blog</a><ul class="nav-list"><li class="nav-list-item "> <a href="http://0.0.0.0:4000/tutorials/building-a-blog/the-post-service" class="nav-list-link">The Post Service</a> </li></ul></li><li class="nav-list-item "><a href="http://0.0.0.0:4000/tutorials/config" class="nav-list-link">Dynamic Config</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://0.0.0.0:4000/resources" class="nav-list-link">Resources</a><ul class="nav-list "><li class="nav-list-item "><a href="http://0.0.0.0:4000/resources/community" class="nav-list-link">Community</a></li><li class="nav-list-item "><a href="http://0.0.0.0:4000/resources/development" class="nav-list-link">Development</a></li><li class="nav-list-item "><a href="http://0.0.0.0:4000/resources/support" class="nav-list-link">Support</a></li></ul></li><li class="nav-list-item"><a href="http://0.0.0.0:4000/faq" class="nav-list-link">FAQ</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search M3O Dev" aria-label="Search M3O Dev" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="http://0.0.0.0:4000/tutorials">Tutorials</a></li> <li class="breadcrumb-nav-list-item"><span>Helloworld</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <h1 class="no_toc" id="helloworld"> <a href="#helloworld" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Helloworld </h1> <h2 class="no_toc text-delta" id="table-of-contents"> <a href="#table-of-contents" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Table of contents </h2> <ol id="markdown-toc"> <li><a href="#installation" id="markdown-toc-installation">Installation</a></li> <li><a href="#running-a-service" id="markdown-toc-running-a-service">Running a service</a></li> <li><a href="#calling-a-service" id="markdown-toc-calling-a-service">Calling a service</a> <ol> <li><a href="#with-the-cli" id="markdown-toc-with-the-cli">With the CLI</a></li> <li><a href="#with-the-framework" id="markdown-toc-with-the-framework">With the framework</a></li> <li><a href="#from-other-languages" id="markdown-toc-from-other-languages">From other languages</a></li> </ol> </li> <li><a href="#creating-a-service" id="markdown-toc-creating-a-service">Creating a service</a></li> <li><a href="#storage" id="markdown-toc-storage">Storage</a> <ol> <li><a href="#interfaces-as-building-blocks" id="markdown-toc-interfaces-as-building-blocks">Interfaces as building blocks</a></li> <li><a href="#using-the-store" id="markdown-toc-using-the-store">Using the Store</a> <ol> <li><a href="#with-the-cli-1" id="markdown-toc-with-the-cli-1">With the CLI</a></li> <li><a href="#with-the-framework-1" id="markdown-toc-with-the-framework-1">With the framework</a></li> </ol> </li> </ol> </li> <li><a href="#updating-a-service" id="markdown-toc-updating-a-service">Updating a service</a></li> <li><a href="#config" id="markdown-toc-config">Config</a> <ol> <li><a href="#cli" id="markdown-toc-cli">CLI</a></li> <li><a href="#with-the-framework-2" id="markdown-toc-with-the-framework-2">With the framework</a></li> </ol> </li> <li><a href="#further-reading" id="markdown-toc-further-reading">Further reading</a></li> </ol> <hr /> <h2 id="installation"> <a href="#installation" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Installation </h2> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># MacOS</span>
curl <span class="nt">-fsSL</span> https://raw.githubusercontent.com/micro/micro/master/scripts/install.sh | /bin/bash

<span class="c"># Linux</span>
wget <span class="nt">-q</span>  https://raw.githubusercontent.com/micro/micro/master/scripts/install.sh <span class="nt">-O</span> - | /bin/bash

<span class="c"># Windows</span>
powershell <span class="nt">-Command</span> <span class="s2">"iwr -useb https://raw.githubusercontent.com/micro/micro/master/scripts/install.ps1 | iex"</span>
</code></pre></div></div> <h2 id="running-a-service"> <a href="#running-a-service" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Running a service </h2> <p>Before diving into writing a service, let’s run an existing one, because it’s just a few commands away!</p> <p>First, we have to start the <code class="highlighter-rouge">micro server</code>. The command to do that is:</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>micro server
</code></pre></div></div> <p>Before interacting with the <code class="highlighter-rouge">micro server</code>, we need to log in with the id ‘admin’ and password ‘micro’:</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>micro login
Enter email address: admin
Enter Password:
Successfully logged <span class="k">in</span><span class="nb">.</span>
</code></pre></div></div> <p>If all goes well you’ll see log output from the server listing the services as it starts them. Just to verify that everything is in order, let’s see what services are running:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ micro services
api
auth
broker
config
network
proxy
registry
runtime
server
store
</code></pre></div></div> <p>All those services are ones started by our <code class="highlighter-rouge">micro server</code>. This is pretty cool, but still it’s not something we launched! Let’s start a service for which existence we can actually take credit for. If we go to <a href="https://github.com/micro/services">github.com/micro/services</a>, we see a bunch of services written by micro authors. One of them is the <code class="highlighter-rouge">helloworld</code>. Try our luck, shall we?</p> <p>The command to run services is <code class="highlighter-rouge">micro run</code>.</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>micro run github.com/micro/services/helloworld
</code></pre></div></div> <p>If we take a look at the running services using <code class="highlighter-rouge">micro status</code>, we should see the service listed:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>NAME		VERSION	SOURCE		STATUS	BUILD	UPDATED	METADATA
helloworld	latest	helloworld	running	n/a	unknown	owner=n/a,group=n/a
</code></pre></div></div> <p>We can also have a look at logs of the service to verify it’s running.</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>micro logs helloworld
micro@Bens-MBP-3 micro % micro logs helloworld
2020-08-11 15:18:33  <span class="nv">file</span><span class="o">=</span>service/service.go:192 <span class="nv">level</span><span class="o">=</span>info Starting <span class="o">[</span>service] helloworld
2020-08-11 15:18:33  <span class="nv">file</span><span class="o">=</span>grpc/grpc.go:902 <span class="nv">level</span><span class="o">=</span>info Server <span class="o">[</span>grpc] Listening on <span class="o">[</span>::]:49602
2020-08-11 15:18:33  <span class="nv">file</span><span class="o">=</span>grpc/grpc.go:728 <span class="nv">level</span><span class="o">=</span>info Registry <span class="o">[</span>service] Registering node: helloworld-c49ee2a3-e9d0-4411-9b9b-5fe6aea6b49d
</code></pre></div></div> <p>So since our service is running happily, let’s try to call it! That’s what services are for.</p> <h2 id="calling-a-service"> <a href="#calling-a-service" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Calling a service </h2> <p>We have a couple of options to call a service running on our <code class="highlighter-rouge">micro server</code>.</p> <h3 id="with-the-cli"> <a href="#with-the-cli" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> With the CLI </h3> <p>Micro auto-generates CLI commands for your service in the form: <code class="highlighter-rouge">micro [service] [method]</code>, with the default method being “Call”. Arguments can be passed as flags, hence we can call our service using:</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>micro helloworld <span class="nt">--name</span><span class="o">=</span>Jane
<span class="o">{</span>
	<span class="s2">"msg"</span>: <span class="s2">"Hello Jane"</span>
<span class="o">}</span>

</code></pre></div></div> <p>That worked! If we wonder what nodes and endpoints a service has we can run the following command:</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>micro get service helloworld
</code></pre></div></div> <h3 id="with-the-framework"> <a href="#with-the-framework" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> With the framework </h3> <p>Let’s write a small client we can use to call the helloworld service. Normally you’ll make a service call inside another service so this is just a sample of a function you may write. We’ll <a href="#-writing-a-service">learn how to write a full fledged service soon</a>.</p> <p>Let’s take the following file:</p> <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span> <span class="n">main</span>

<span class="k">import</span> <span class="p">(</span>
	<span class="s">"context"</span>
	<span class="s">"fmt"</span>
	<span class="s">"time"</span>

	<span class="s">"github.com/micro/micro/v3/service"</span>
	<span class="n">proto</span> <span class="s">"github.com/micro/services/helloworld/proto"</span>
<span class="p">)</span>

<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="c">// create and initialise a new service</span>
	<span class="n">srv</span> <span class="o">:=</span> <span class="n">service</span><span class="o">.</span><span class="n">New</span><span class="p">()</span>

		<span class="c">// create the proto client for helloworld</span>
		<span class="n">client</span> <span class="o">:=</span> <span class="n">proto</span><span class="o">.</span><span class="n">NewHelloworldService</span><span class="p">(</span><span class="s">"helloworld"</span><span class="p">,</span> <span class="n">srv</span><span class="o">.</span><span class="n">Client</span><span class="p">())</span>

		<span class="c">// call an endpoint on the service</span>
		<span class="n">rsp</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">client</span><span class="o">.</span><span class="n">Call</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">Background</span><span class="p">(),</span> <span class="o">&amp;</span><span class="n">proto</span><span class="o">.</span><span class="n">Request</span><span class="p">{</span>
			<span class="n">Name</span><span class="o">:</span> <span class="s">"John"</span><span class="p">,</span>
		<span class="p">})</span>
		<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
			<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"Error calling helloworld: "</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
			<span class="k">return</span>
		<span class="p">}</span>

		<span class="c">// print the response</span>
		<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"Response: "</span><span class="p">,</span> <span class="n">rsp</span><span class="o">.</span><span class="n">Msg</span><span class="p">)</span>
		
		<span class="c">// let's delay the process for exiting for reasons you'll see below</span>
		<span class="n">time</span><span class="o">.</span><span class="n">Sleep</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">Second</span> <span class="o">*</span> <span class="m">5</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div> <p>Save the example locally. For ease of following this guide, name the folder <code class="highlighter-rouge">example-service</code>. After doing a <code class="highlighter-rouge">cd example-service &amp;&amp; go mod init example</code>, we are ready to run this service with <code class="highlighter-rouge">micro run</code>:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>micro run .
</code></pre></div></div> <p><code class="highlighter-rouge">micro run</code>s, when successful, do not print any output. A useful command to see what is running, is <code class="highlighter-rouge">micro status</code>. At this point we should have two services running:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ micro status
NAME							VERSION		SOURCE																	STATUS		BUILD	UPDATED		METADATA
example-service		latest		example-service													starting	n/a		4s ago		owner=n/a,group=n/a
helloworld				latest		github.com/micro/services/helloworld		running		n/a		unknown		owner=n/a,group=n/a
</code></pre></div></div> <p>Now, since our example-service client is also running, we should be able to see it’s logs:</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>micro logs example-service
<span class="c"># some go build output here</span>
Response:  Hello John
</code></pre></div></div> <p>Great! That response is coming straight from the helloworld service we started earlier!</p> <h3 id="from-other-languages"> <a href="#from-other-languages" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> From other languages </h3> <p>In the <a href="https://github.com/micro/clients">clients repo</a> there are Micro clients for various languages and frameworks. They are designed to connect easily to the live Micro environment or your local one, but more about environments later.</p> <h2 id="creating-a-service"> <a href="#creating-a-service" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Creating a service </h2> <p>To create a new service, use the <code class="highlighter-rouge">micro new</code> command. It should output something reasonably similar to the following:</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>micro new helloworld
Creating service helloworld <span class="k">in </span>helloworld

<span class="nb">.</span>
├── main.go
├── generate.go
├── plugin.go
├── handler
│   └── helloworld.go
├── subscriber
│   └── helloworld.go
├── proto/helloworld
│   └── helloworld.proto
├── Dockerfile
├── Makefile
├── README.md
├── .gitignore
└── go.mod


download protobuf <span class="k">for </span>micro:

brew <span class="nb">install </span>protobuf
go get <span class="nt">-u</span> github.com/golang/protobuf/proto
go get <span class="nt">-u</span> github.com/golang/protobuf/protoc-gen-go
go get github.com/micro/micro/v3/cmd/protoc-gen-micro@master

compile the proto file helloworld.proto:

<span class="nb">cd </span>helloworld
protoc <span class="nt">--proto_path</span><span class="o">=</span>.:<span class="nv">$GOPATH</span>/src <span class="nt">--go_out</span><span class="o">=</span><span class="nb">.</span> <span class="nt">--micro_out</span><span class="o">=</span><span class="nb">.</span> proto/helloworld/helloworld.proto
</code></pre></div></div> <p>As can be seen from the output above, before building the first service, the following tools must be installed:</p> <ul> <li><a href="http://google.github.io/proto-lens/installing-protoc.html">protoc</a></li> <li><a href="github.com/golang/protobuf/protoc-gen-go">protobuf/proto</a></li> <li><a href="github.com/golang/protobuf/protoc-gen-go">protoc-gen-micro</a></li> </ul> <p>They are all needed to translate proto files to actual Go code. Protos exist to provide a language agnostic way to describe service endpoints, their input and output types, and to have an efficient serialization format at hand.</p> <p>Currently Micro is Go focused (apart from the <a href="#-from-other-languages">clients</a> mentioned before), but this will change soon.</p> <p>So once all tools are installed, being inside the service root, we can issue the following command to generate the Go code from the protos:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>protoc --proto_path=.:$GOPATH/src --go_out=. --micro_out=. proto/helloworld.proto
</code></pre></div></div> <p>The generated code must be committed to source control, to enable other services to import the proto when making service calls (see previous section <a href="#-calling-a-service">Calling a service</a>.</p> <p>At this point, we know how to write a service, run it, and call other services too. We have everything at our fingertips, but there are still some missing pieces to write applications. One of such pieces is the store interface, which helps with persistent data storage even without a database.</p> <h2 id="storage"> <a href="#storage" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Storage </h2> <p>Amongst many other useful built-in services Micro includes a persistent storage service for storing data.</p> <h3 id="interfaces-as-building-blocks"> <a href="#interfaces-as-building-blocks" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Interfaces as building blocks </h3> <p>A quick side note. Micro (the server/CLI) and Go Micro (the framework) are centered around strongly defined interfaces which are pluggable and provide an abstraction for underlying distributed systems concepts. What does this mean?</p> <p>Let’s take our current case of the <a href="https://github.com/micro/go-micro/blob/master/store/store.go">store interface</a>. It’s aimed to enable service writers data storage with a couple of different implementations:</p> <ul> <li>in memory</li> <li>file storage (default when running <code class="highlighter-rouge">micro server</code>)</li> <li>cockroachdb</li> </ul> <p>Similarly, the <a href="https://github.com/micro/go-micro/blob/master/runtime/runtime.go">runtime</a> interface, that allows you to run services in a completely runtime agnostic way has a few implementations:</p> <ul> <li>local, which just runs actual processes - aimed at local development</li> <li>kubernetes - for running containers in a highly available and distributed way</li> </ul> <p>This is a recurring theme across Micro interfaces. Let’s take a look at the default store when running <code class="highlighter-rouge">micro server</code>.</p> <h3 id="using-the-store"> <a href="#using-the-store" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Using the Store </h3> <h4 id="with-the-cli-1"> <a href="#with-the-cli-1" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> With the CLI </h4> <p>First, let’s go over the more basic store CLI commands.</p> <p>To save a value, we use the write command:</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>micro store write key1 value1
</code></pre></div></div> <p>The UNIX style no output meant it was happily saved. What about reading it?</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ micro store read key1
val1
</code></pre></div></div> <p>Or to display it in a fancier way, we can use the <code class="highlighter-rouge">--verbose</code> or <code class="highlighter-rouge">-v</code> flags.</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ micro store read -v key1
KEY    VALUE   EXPIRY
key1   val1    None
</code></pre></div></div> <p>This view is especially useful when we use the <code class="highlighter-rouge">--prefix</code> or <code class="highlighter-rouge">-p</code> flag, which lets us search for entries which key have certain prefixes.</p> <p>To demonstrate that first let’s save an other value:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ micro store write key2 val2
</code></pre></div></div> <p>After this, we can list both <code class="highlighter-rouge">key1</code> and <code class="highlighter-rouge">key2</code> keys as they both share commond prefixes:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ micro store read --prefix --verbose key
KEY    VALUE   EXPIRY
key1   val1    None
key2   val2    None
</code></pre></div></div> <p>There is more to the store, but this knowledge already enables us to be dangerous!</p> <h4 id="with-the-framework-1"> <a href="#with-the-framework-1" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> With the framework </h4> <p>Accessing the same data we have just manipulated from our Go Micro services could not be easier. First let’s create an entry that our service can read. This time we will specify the table for the <code class="highlighter-rouge">micro store write</code> command too, as each service has its own table in the store:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>micro store write --table=example mykey "Hi there"
</code></pre></div></div> <p>Let’s modify <a href="#-calling-a-service-with-go-micro">the example service we wrote previously</a> so instead of calling a service, it reads the above value from a store.</p> <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span> <span class="n">main</span>

<span class="k">import</span> <span class="p">(</span>
	<span class="s">"fmt"</span>
	<span class="s">"time"</span>

	<span class="s">"github.com/micro/micro/v3/service"</span>
	<span class="s">"github.com/micro/micro/v3/service/store"</span>
<span class="p">)</span>

<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="n">srv</span> <span class="o">:=</span> <span class="n">service</span><span class="o">.</span><span class="n">New</span><span class="p">(</span><span class="n">service</span><span class="o">.</span><span class="n">Name</span><span class="p">(</span><span class="s">"example"</span><span class="p">))</span>
	<span class="n">srv</span><span class="o">.</span><span class="n">Init</span><span class="p">()</span>

	<span class="n">records</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">store</span><span class="o">.</span><span class="n">Read</span><span class="p">(</span><span class="s">"mykey"</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
		<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"Error reading from store: "</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">records</span><span class="p">)</span> <span class="o">==</span> <span class="m">0</span> <span class="p">{</span>
		<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"No records"</span><span class="p">)</span>
	<span class="p">}</span>
	<span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">record</span> <span class="o">:=</span> <span class="k">range</span> <span class="n">records</span> <span class="p">{</span>
		<span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"key: %v, value: %v</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">record</span><span class="o">.</span><span class="n">Key</span><span class="p">,</span> <span class="kt">string</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">Value</span><span class="p">))</span>
	<span class="p">}</span>

	<span class="n">time</span><span class="o">.</span><span class="n">Sleep</span><span class="p">(</span><span class="m">1</span> <span class="o">*</span> <span class="n">time</span><span class="o">.</span><span class="n">Hour</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div> <h2 id="updating-a-service"> <a href="#updating-a-service" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Updating a service </h2> <p>Now since the example service is running (can be easily verified by <code class="highlighter-rouge">micro status</code>), we should not use <code class="highlighter-rouge">micro run</code>, but rather <code class="highlighter-rouge">micro update</code> to deploy it.</p> <p>We can simply issue the update command (remember to switch back to the root directory of the example service first):</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>micro update .
</code></pre></div></div> <p>And verify both with the micro server output:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Updating service example-service version latest source /home/username/example-service
Processing update event example-service:latest in namespace default
</code></pre></div></div> <p>and micro status:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ micro status example-service
NAME			VERSION	SOURCE							STATUS		BUILD	UPDATED		METADATA
example-service	latest	example-service.tar.gz			running	n/a	unknown	owner=n/a,group=n/a
</code></pre></div></div> <p>that it was updated.</p> <p>If things for some reason go haywire, we can try the time tested “turning it off and on again” solution and do:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>micro kill example-service
micro run example-service
</code></pre></div></div> <p>to start with a clean slate.</p> <p>So once we did update the example service, we should see the following in the logs:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ micro logs example-service
key: mykey, value: Hi there
</code></pre></div></div> <h2 id="config"> <a href="#config" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Config </h2> <p>Note: this is a quick overview of config. For a more in depth look, please refer to the <a href="https://m3o.dev/tutorials/config">config tutorial</a>.</p> <p>Configuration and secrets is an essential part of any production system - let’s see how the Micro config works.</p> <h3 id="cli"> <a href="#cli" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> CLI </h3> <p>The most basic example of config usage is the following:</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>micro config <span class="nb">set </span>key val
<span class="nv">$ </span>micro config get key
val
</code></pre></div></div> <p>While this alone is enough for a great many use cases, for purposes of organisation, Micro also support dot notation of keys. Let’s overwrite our keys set previously:</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>micro config <span class="nb">set </span>key.subkey val
<span class="nv">$ </span>micro config get key.subkey
val
</code></pre></div></div> <p>This is fairly straightforward, but what happens when we get <code class="highlighter-rouge">key</code>?</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>micro config get key
<span class="o">{</span><span class="s2">"subkey"</span>:<span class="s2">"val"</span><span class="o">}</span>
</code></pre></div></div> <p>As it can be seen, leaf level keys will return only the value, while node level keys return the whole subtree as a JSON document:</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>micro config <span class="nb">set </span>key.othersubkey val2
<span class="nv">$ </span>micro config get key
<span class="o">{</span><span class="s2">"othersubkey"</span>:<span class="s2">"val2"</span>,<span class="s2">"subkey"</span>:<span class="s2">"val"</span><span class="o">}</span>
</code></pre></div></div> <h3 id="with-the-framework-2"> <a href="#with-the-framework-2" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> With the framework </h3> <p>Micro configs work very similarly when being called from <a href="https://pkg.go.dev/github.com/micro/go-micro/v3/config?tab=doc">Go code too</a>:</p> <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span> <span class="n">main</span>

<span class="k">import</span> <span class="p">(</span>
	<span class="s">"fmt"</span>

	<span class="s">"github.com/micro/micro/v3/service"</span>
	<span class="s">"github.com/micro/micro/v3/service/config"</span>
<span class="p">)</span>

<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="c">// setup the service</span>
	<span class="n">srv</span> <span class="o">:=</span> <span class="n">service</span><span class="o">.</span><span class="n">New</span><span class="p">(</span><span class="n">service</span><span class="o">.</span><span class="n">Name</span><span class="p">(</span><span class="s">"example"</span><span class="p">))</span>
	<span class="n">srv</span><span class="o">.</span><span class="n">Init</span><span class="p">()</span>

	<span class="c">// read config value</span>
	<span class="n">val</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">config</span><span class="o">.</span><span class="n">Get</span><span class="p">(</span><span class="s">"key"</span><span class="p">,</span> <span class="s">"subkey"</span><span class="p">)</span>
	<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"Value of key.subkey: "</span><span class="p">,</span> <span class="n">val</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="s">""</span><span class="p">),</span> <span class="n">err</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div> <p>Assuming the folder name for this service is still <code class="highlighter-rouge">example-service</code> (to update the existing service, <a href="#-updating-a-service">see updating a service</a>):</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ micro logs example-service
Value of key.subkey:  val
</code></pre></div></div> <h2 id="further-reading"> <a href="#further-reading" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Further reading </h2> <p>This is just a brief getting started guide for quickly getting up and running with Micro. Come back from time to time to learn more as this guide gets continually upgraded. If you’re interested in learning more Micro magic, have a look at the following sources:</p> <ul> <li>Read the <a href="https://micro.mu/docs">docs</a></li> <li>Learn by <a href="https://github.com/micro/services">example</a></li> <li>Ask questions on <a href="https://slack.m3o.com">Slack</a></li> </ul> <hr> <footer> <p class="text-small text-grey-dk-000 mb-0">Copyright &copy; 2020 Micro Services, Inc.</p> </footer> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
